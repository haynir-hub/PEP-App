<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>אזור ניהול – נושאי PEP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="pep-skin">
  <div class="appbar">
    <div class="appbar__inner container">
      <div class="brand">
        <div class="brand__logo">
          <img class="brand__img" src="/assets/pep-logo.png" alt="PEP Logo" />
        </div>
        <div class="brand__title">ניהול נושאי PEP</div>
      </div>
      <div><a class="btn secondary btn-sm" href="/admin">חזור לאזור ניהול</a></div>
    </div>
  </div>

  <main class="container" style="margin-top:20px;">
    <div class="grid-2">
      <section class="section">
        <div class="h3">הוסף נושא</div>
        <div class="mt-12" style="display:flex; gap:8px;">
          <input id="subjectName" class="input" placeholder="שם הנושא" />
          <button id="add" class="btn btn-sm">הוסף</button>
        </div>
      </section>

      <section class="section">
        <div class="h3">כל הנושאים</div>
        <div id="list" class="mt-12" style="display:grid; gap:10px;"></div>
      </section>
    </div>
  </main>

  <script>
    const els={ name:document.getElementById('subjectName'), add:document.getElementById('add'), list:document.getElementById('list') };

    function row(s){
      const card=document.createElement('div'); card.className='card'; card.style.display='flex'; card.style.justifyContent='space-between'; card.style.alignItems='center';
      const t=document.createElement('div'); t.className='h3'; t.textContent=s.name;
      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
      const edit=document.createElement('button'); edit.className='btn secondary btn-xs'; edit.textContent='ערוך';
      const del=document.createElement('button'); del.className='btn btn-xs btn-outline'; del.textContent='מחק';
      edit.onclick=async()=>{
        const newName=prompt('שם חדש לנושא:', s.name);
        if(!newName || !newName.trim()) return;
        const r=await fetch('/api/subjects/'+s.id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:newName.trim()})});
        if(r.ok) load();
      };
      del.onclick=async()=>{
        if(!confirm('למחוק נושא זה?')) return;
        const r=await fetch('/api/subjects/'+s.id,{method:'DELETE'});
        if(r.ok) load();
      };
      actions.appendChild(edit); actions.appendChild(del);
      card.appendChild(t); card.appendChild(actions);
      return card;
    }

    async function load(){
      const r=await fetch('/api/subjects'); const d=await r.json();
      els.list.innerHTML=''; (d.subjects||[]).forEach(s=>els.list.appendChild(row(s)));
    }

    els.add.onclick=async()=>{
      const name=(els.name.value||'').trim(); if(!name) return alert('יש להזין שם נושא');
      const r=await fetch('/api/subjects',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});
      if(r.ok){ els.name.value=''; load(); } else { alert('שגיאה בהוספה'); }
    };

    load();
  </script>
</body>
</html>
