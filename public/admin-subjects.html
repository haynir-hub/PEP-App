<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ניהול נושאים</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f4f7f9; color: #333; margin: 20px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; }
        a { color: #007bff; text-decoration: none; }
        nav { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; display: flex; gap: 20px; align-items: center; }
        nav a { font-weight: bold; font-size: 18px; }
        form { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        ul { list-style-type: none; padding: 0; }
        li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .actions button { margin-left: 10px; background-color: #6c757d; font-size: 12px; padding: 5px 10px; }
        .actions .delete-btn { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="/admin">תרגילי PEP</a>
            <a href="/admin-nika-games">משחקי NIKA</a>
            <div style="margin-inline-start: auto; display: flex; gap: 15px;">
                <a href="/api/auth/view-as-pep" style="color: #007bff;">צפה כ-PEP</a>
                <a href="/api/auth/view-as-nika" style="color: #d946ef;">צפה כ-NIKA</a>
            </div>
        </nav>
        <h1>ניהול נושאים</h1>
        <form id="subject-form">
            <h2>הוסף נושא חדש</h2>
            <input type="text" id="subject-name" placeholder="שם הנושא" required>
            <button type="submit">הוסף</button>
        </form>
        <h2>נושאים קיימים</h2>
        <ul id="subjects-list"></ul>
    </div>
    <script>
        const subjectForm = document.getElementById('subject-form');
        const subjectNameInput = document.getElementById('subject-name');
        const subjectsList = document.getElementById('subjects-list');
        async function jsonFetch(url, options = {}) { const defaultOptions = { credentials: 'include', headers: { 'Content-Type': 'application/json' } }; const response = await fetch(url, { ...defaultOptions, ...options }); const data = await response.json().catch(() => ({})); if (!response.ok) { throw new Error(data.error || 'Request Failed'); } return data; }
        async function renderSubjects() { try { const { subjects } = await jsonFetch('/api/subjects'); subjectsList.innerHTML = ''; subjects.forEach(subject => { const li = document.createElement('li'); li.innerHTML = `<span>${subject.name}</span><div class="actions"><button class="edit-btn" data-id="${subject.id}" data-name="${subject.name}">ערוך</button><button class="delete-btn" data-id="${subject.id}">מחק</button></div>`; subjectsList.appendChild(li); }); } catch(e) { console.error(e) } }
        subjectForm.addEventListener('submit', async e => { e.preventDefault(); const name = subjectNameInput.value.trim(); if (!name) return; try { await jsonFetch('/api/subjects', { method: 'POST', body: JSON.stringify({ name }) }); subjectNameInput.value = ''; renderSubjects(); } catch(e) { alert(`שגיאה: ${e.message}`) } });
        subjectsList.addEventListener('click', async e => { const id = e.target.dataset.id; if (e.target.classList.contains('delete-btn')) { if (confirm('האם אתה בטוח?')) { try { await jsonFetch(`/api/subjects/${id}`, { method: 'DELETE' }); renderSubjects(); } catch(e) { alert(`שגיאה: ${e.message}`) } } } if (e.target.classList.contains('edit-btn')) { const currentName = e.target.dataset.name; const newName = prompt('הזן שם חדש:', currentName); if (newName && newName.trim()) { try { await jsonFetch(`/api/subjects/${id}`, { method: 'PUT', body: JSON.stringify({ name: newName.trim() }) }); renderSubjects(); } catch(e) { alert(`שגיאה: ${e.message}`) } } } });
        renderSubjects();
    </script>
</body>
</html>