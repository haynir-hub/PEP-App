<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>PEP – המערכים שלי</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="pep-skin">
  <div class="appbar">
    <div class="appbar__inner container">
      <div class="brand">
        <div class="brand__logo"><img class="brand__img" src="/assets/pep-logo.png" alt="PEP Logo" /></div>
        <div class="brand__title">PEP – המערכים שלי</div>
      </div>
      <div class="flex items-center gap-8">
        <a class="btn secondary btn-sm" href="/lesson-builder">חזור לבונה המערכים</a>
        <a class="btn secondary btn-sm" href="/admin">אזור ניהול</a>
      </div>
    </div>
  </div>

  <main class="container" style="margin-top:20px;">
    <section class="section">
      <div class="h3">הרשימה שלי</div>
      <div id="list" class="mt-12" style="display:grid; gap:12px;"></div>
    </section>
  </main>

  <script>
    async function load(){
      const r=await fetch('/api/my-lesson-plans'); const d=await r.json();
      const list=document.getElementById('list'); list.innerHTML='';
      (d.lesson_plans||[]).filter(x=>x.organization==='PEP').forEach(lp=>{
        const card=document.createElement('div'); card.className='card';
        const title=document.createElement('div'); title.className='h3'; title.textContent=lp.name||'—';
        const meta=document.createElement('div'); meta.className='muted mt-8'; meta.textContent=`נוצר ב: ${new Date(lp.created_at).toLocaleString('he-IL')}`;

        const actions=document.createElement('div'); actions.className='mt-12'; actions.style.display='flex'; actions.style.gap='8px';
        const pdf=document.createElement('a'); pdf.href=`/api/lesson-plans/${lp.id}/pdf`; pdf.className='btn btn-sm'; pdf.textContent='ייצא ל־PDF';
        const edit=document.createElement('a'); edit.href=`/lesson-builder?id=${lp.id}`; edit.className='btn secondary btn-sm'; edit.textContent='ערוך';
        const del=document.createElement('button'); del.className='btn btn-danger-soft btn-xs'; del.textContent='מחק';
        del.onclick=async()=>{ if(!confirm('למחוק מערך זה?'))return; const r=await fetch('/api/lesson-plans/'+lp.id,{method:'DELETE'}); if(r.ok) load(); };

        actions.appendChild(pdf); actions.appendChild(edit); actions.appendChild(del);
        card.appendChild(title); card.appendChild(meta); card.appendChild(actions);
        list.appendChild(card);
      });
    }
    load();
  </script>
</body>
</html>
